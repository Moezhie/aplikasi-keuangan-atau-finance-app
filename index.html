<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Pencatatan Keuangan</title>
    <!-- Font Awesome untuk Ikon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <!-- jsPDF untuk Export PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }

        body {
            background: #F4F6F9;
            overflow-x: hidden;
        }

        .page {
            transition: opacity 0.3s ease, transform 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
            display: none;
        }
        .page.active {
            opacity: 1;
            transform: translateY(0);
            display: block;
        }

        .navbar {
            background: #007BFF;
            padding: 15px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .navbar .logo {
            font-size: 20px;
            font-weight: bold;
        }
        .navbar a {
            color: white;
            text-decoration: none;
            margin-left: 20px;
            font-size: 16px;
            transition: color 0.2s;
        }
        .navbar a:hover {
            color: #E6F3FA;
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #E6F3FA, #B3E5FC);
            padding: 20px;
        }
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 20px;
            text-align: left;
            position: relative;
        }
        .form-group label {
            font-size: 14px;
            color: #555;
        }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        .form-group .error {
            color: #DC3545;
            font-size: 12px;
            position: absolute;
            bottom: -18px;
        }
        .form-group .terbilang {
            font-size: 12px;
            color: #333;
            margin-top: 5px;
            display: block;
        }
        .login-btn, .register-btn, .forgot-btn {
            width: 100%;
            padding: 12px;
            background: #28A745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .login-btn:hover, .register-btn:hover, .forgot-btn:hover {
            background: #218838;
        }
        .login-btn.loading, .register-btn.loading, .forgot-btn.loading {
            background: #6C757D;
            cursor: not-allowed;
        }
        .links a {
            color: #007BFF;
            font-size: 14px;
            text-decoration: none;
            margin: 0 5px;
            cursor: pointer;
        }
        @media (max-width: 480px) {
            .login-box {
                padding: 20px;
                max-width: 90%;
            }
            .navbar a {
                font-size: 14px;
                margin-left: 10px;
            }
        }
        @media (min-width: 768px) {
            .login-box {
                padding: 40px;
                max-width: 400px;
            }
        }

        .dashboard-container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .card {
            flex: 1;
            background: #007BFF;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.2s;
            min-width: 200px;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .card:nth-child(2) { background: #28A745; }
        .card:nth-child(3) { background: #DC3545; }
        .card i { font-size: 30px; margin-bottom: 10px; }
        .card h3 { font-size: 18px; margin: 10px 0; }
        .card p { font-size: 24px; font-weight: bold; }
        .table-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .table-container .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .table-container select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .print-btn, .export-btn, .export-pdf-btn {
            padding: 10px 20px;
            background: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
        }
        .print-btn:hover, .export-btn:hover, .export-pdf-btn:hover {
            background: #0056b3;
        }
        table.dataTable {
            width: 100% !important;
        }
        .action-btn {
            padding: 5px 10px;
            margin: 0 5px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        .edit-btn { background: #FFC107; color: white; }
        .delete-btn { background: #DC3545; color: white; }
        @media (max-width: 480px) {
            .stats { flex-direction: column; }
            .filters { flex-direction: column; }
            .table-container { padding: 10px; }
        }
        @media (min-width: 768px) {
            .stats { flex-direction: row; }
            .filters { flex-direction: row; }
        }

        .form-container, .settings-container {
            max-width: 600px;
            margin: 20px auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .form-container h2, .settings-container h2 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
        }
        .form-group input:disabled {
            background: #f8f8f8;
            color: #999;
        }
        .form-group textarea {
            height: 100px;
            resize: vertical;
        }
        .save-btn, .cancel-btn, .update-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .save-btn, .update-btn {
            background: #28A745;
            color: white;
        }
        .save-btn:hover, .update-btn:hover {
            background: #218838;
        }
        .save-btn.loading, .update-btn.loading {
            background: #6C757D;
            cursor: not-allowed;
        }
        .cancel-btn {
            background: #6C757D;
            color: white;
            margin-left: 10px;
        }
        .cancel-btn:hover {
            background: #5A6268;
        }
        @media (max-width: 480px) {
            .form-container, .settings-container {
                max-width: 90%;
                padding: 20px;
            }
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            padding: 15px;
            background: #28A745;
            color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s, transform 0.3s;
        }
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        .notification.error {
            background: #DC3545;
        }
        .notification p {
            margin: 0 0 10px;
            font-size: 14px;
        }
        .notification button {
            background: #218838;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        .notification button:hover {
            background: #1e7e34;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            width: 100%;
            max-width: 400px;
        }
        .modal-content h3 {
            margin-bottom: 20px;
        }
        .modal-content button {
            padding: 10px 20px;
            margin: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .modal-content .confirm-btn {
            background: #28A745;
            color: white;
        }
        .modal-content .cancel-btn {
            background: #6C757D;
            color: white;
        }
        @media (max-width: 480px) {
            .modal-content {
                max-width: 90%;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <div class="navbar">
        <div class="logo">Aplikasi Keuangan</div>
        <div id="navbar-links">
            <a href="#" onclick="showSection('login')">Login</a>
        </div>
    </div>

    <!-- Login Page -->
    <div class="login-container page" id="login">
        <div class="login-box">
            <h2 class="logo">Aplikasi Keuangan</h2>
            <div id="login-form">
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" placeholder="Masukkan username" required>
                        <span class="error" id="username-error"></span>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" placeholder="Masukkan password" required>
                        <span class="error" id="password-error"></span>
                    </div>
                    <button type="submit" class="login-btn">Login</button>
                    <div class="links">
                        <a onclick="showRegisterForm()">Daftar</a> | 
                        <a onclick="showForgotForm()">Lupa Username/Kata Sandi</a>
                    </div>
                </form>
            </div>
            <div id="register-form" style="display: none;">
                <form onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label for="reg-username">Username</label>
                        <input type="text" id="reg-username" placeholder="Masukkan username" required>
                        <span class="error" id="reg-username-error"></span>
                    </div>
                    <div class="form-group">
                        <label for="reg-password">Password</label>
                        <input type="password" id="reg-password" placeholder="Masukkan password" required>
                        <span class="error" id="reg-password-error"></span>
                    </div>
                    <div class="form-group">
                        <label for="reg-phone">No. HP</label>
                        <input type="tel" id="reg-phone" placeholder="Masukkan nomor HP" required>
                        <span class="error" id="reg-phone-error"></span>
                    </div>
                    <div class="form-group">
                        <label for="reg-email">Email</label>
                        <input type="email" id="reg-email" placeholder="Masukkan email" required>
                        <span class="error" id="reg-email-error"></span>
                    </div>
                    <button type="submit" class="register-btn">Daftar</button>
                    <div class="links">
                        <a onclick="showLoginForm()">Kembali ke Login</a>
                    </div>
                </form>
            </div>
            <div id="forgot-form" style="display: none;">
                <form onsubmit="handleForgot(event)">
                    <div class="form-group">
                        <label for="forgot-email">Email</label>
                        <input type="email" id="forgot-email" placeholder="Masukkan email" required>
                        <span class="error" id="forgot-email-error"></span>
                    </div>
                    <button type="submit" class="forgot-btn">Kirim Link Pemulihan</button>
                    <div class="links">
                        <a onclick="showLoginForm()">Kembali ke Login</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard-container page" id="dashboard">
        <div class="stats">
            <div class="card">
                <i class="fas fa-wallet"></i>
                <h3>Total Saldo Keseluruhan</h3>
                <p id="total-saldo">Rp 0</p>
            </div>
            <div class="card">
                <i class="fas fa-arrow-down"></i>
                <h3>Saldo Masuk</h3>
                <p id="saldo-masuk-total">Rp 0</p>
            </div>
            <div class="card">
                <i class="fas fa-arrow-up"></i>
                <h3>Saldo Keluar</h3>
                <p id="saldo-keluar-total">Rp 0</p>
            </div>
        </div>
        <div class="table-container">
            <div class="filters">
                <select id="date-filter">
                    <option value="">Semua Tanggal</option>
                </select>
                <select id="type-filter">
                    <option value="">Semua Tipe</option>
                    <option value="masuk">Saldo Masuk</option>
                    <option value="keluar">Saldo Keluar</option>
                </select>
                <button class="print-btn" onclick="printTable()">Cetak <i class="fas fa-print"></i></button>
                <button class="export-btn" onclick="exportToCSV()">Export CSV</button>
                <button class="export-pdf-btn" onclick="exportToPDF()">Export PDF</button>
            </div>
            <table id="transaction-table" class="display">
                <thead>
                    <tr>
                        <th>ID Transaksi</th>
                        <th>Tanggal</th>
                        <th>Saldo Masuk</th>
                        <th>Keterangan</th>
                        <th>Saldo Keluar</th>
                        <th>Keterangan</th>
                        <th>ID Pengimput</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <!-- Transaksi Masuk -->
    <div class="form-container page" id="transaksi-masuk">
        <h2 id="form-masuk-title">Tambah Transaksi Masuk</h2>
        <form id="transaksi-masuk-form" onsubmit="handleTransaksiMasukSubmit(event)">
            <div class="form-group">
                <label for="id-transaksi-masuk">ID Transaksi</label>
                <input type="text" id="id-transaksi-masuk" value="TRX-000001" disabled>
            </div>
            <div class="form-group">
                <label for="tanggal-masuk">Tanggal</label>
                <input type="text" id="tanggal-masuk" value="2025-05-09" disabled>
            </div>
            <div class="form-group">
                <label for="saldo-masuk">Saldo Masuk</label>
                <input type="text" id="saldo-masuk" placeholder="Masukkan jumlah (Rp)" required>
                <span class="error" id="saldo-masuk-error"></span>
                <span class="terbilang" id="terbilang-masuk"></span>
            </div>
            <div class="form-group">
                <label for="keterangan-masuk">Keterangan</label>
                <textarea id="keterangan-masuk" placeholder="Masukkan keterangan"></textarea>
            </div>
            <div class="form-group">
                <label>Total Saldo Keseluruhan (Otomatis)</label>
                <input type="text" id="total-saldo-masuk" disabled>
            </div>
            <button type="submit" class="save-btn">Simpan</button>
            <button type="button" class="cancel-btn" onclick="clearMasukForm()">Batal</button>
        </form>
    </div>

    <!-- Transaksi Keluar -->
    <div class="form-container page" id="transaksi-keluar">
        <h2 id="form-keluar-title">Tambah Transaksi Keluar</h2>
        <form id="transaksi-keluar-form" onsubmit="handleTransaksiKeluarSubmit(event)">
            <div class="form-group">
                <label for="id-transaksi-keluar">ID Transaksi</label>
                <input type="text" id="id-transaksi-keluar" value="TRX-000001" disabled>
            </div>
            <div class="form-group">
                <label for="tanggal-keluar">Tanggal</label>
                <input type="text" id="tanggal-keluar" value="2025-05-09" disabled>
            </div>
            <div class="form-group">
                <label for="saldo-keluar">Saldo Keluar</label>
                <input type="text" id="saldo-keluar" placeholder="Masukkan jumlah (Rp)" required>
                <span class="error" id="saldo-keluar-error"></span>
                <span class="terbilang" id="terbilang-keluar"></span>
            </div>
            <div class="form-group">
                <label for="keterangan-keluar">Keterangan</label>
                <textarea id="keterangan-keluar" placeholder="Masukkan keterangan"></textarea>
            </div>
            <div class="form-group">
                <label>Total Saldo Keseluruhan (Otomatis)</label>
                <input type="text" id="total-saldo-keluar" disabled>
            </div>
            <button type="submit" class="save-btn">Simpan</button>
            <button type="button" class="cancel-btn" onclick="clearKeluarForm()">Batal</button>
        </form>
    </div>

    <!-- Laporan Bulanan -->
    <div class="dashboard-container page" id="laporan-bulanan">
        <h2>Laporan Bulanan</h2>
        <div class="filters">
            <select id="year-filter">
                <option value="">Semua Tahun</option>
                <option value="2025">2025</option>
            </select>
        </div>
        <div class="table-container">
            <table id="monthly-table" class="display">
                <thead>
                    <tr>
                        <th>Bulan</th>
                        <th>Saldo Masuk</th>
                        <th>Saldo Keluar</th>
                        <th>Total Saldo Keseluruhan</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <!-- Riwayat Aktivitas -->
    <div class="dashboard-container page" id="riwayat-aktivitas">
        <h2>Riwayat Aktivitas</h2>
        <div class="table-container">
            <table id="activity-table" class="display">
                <thead>
                    <tr>
                        <th>Waktu</th>
                        <th>Pengguna</th>
                        <th>Aktivitas</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <!-- Pengaturan -->
    <div class="settings-container page" id="pengaturan">
        <h2>Pengaturan</h2>
        <form id="settings-form" onsubmit="handleSettingsSubmit(event)">
            <div class="form-group">
                <label for="settings-phone">No. HP</label>
                <input type="tel" id="settings-phone" placeholder="Masukkan nomor HP" required>
            </div>
            <div class="form-group">
                <label for="settings-email">Email</label>
                <input type="email" id="settings-email" placeholder="Masukkan email" required>
            </div>
            <button type="submit" class="update-btn">Perbarui</button>
        </form>
        <h2>Ubah Kata Sandi</h2>
        <form id="change-password-form" onsubmit="handleChangePassword(event)">
            <div class="form-group">
                <label for="current-password">Kata Sandi Saat Ini</label>
                <input type="password" id="current-password" placeholder="Masukkan kata sandi saat ini" required>
                <span class="error" id="current-password-error"></span>
            </div>
            <div class="form-group">
                <label for="new-password">Kata Sandi Baru</label>
                <input type="password" id="new-password" placeholder="Masukkan kata sandi baru" required>
                <span class="error" id="new-password-error"></span>
            </div>
            <button type="submit" class="update-btn">Ubah Kata Sandi</button>
        </form>
        <h2>Manajemen Pengguna</h2>
        <form id="add-user-form" onsubmit="handleAddUser(event)">
            <div class="form-group">
                <label for="add-username">Username</label>
                <input type="text" id="add-username" placeholder="Masukkan username" required>
            </div>
            <div class="form-group">
                <label for="add-password">Password</label>
                <input type="password" id="add-password" placeholder="Masukkan password" required>
            </div>
            <div class="form-group">
                <label for="add-phone">No. HP</label>
                <input type="tel" id="add-phone" placeholder="Masukkan nomor HP" required>
            </div>
            <div class="form-group">
                <label for="add-email">Email</label>
                <input type="email" id="add-email" placeholder="Masukkan email" required>
            </div>
            <button type="submit" class="save-btn">Tambah Pengguna</button>
        </form>
        <div class="table-container">
            <table id="user-table" class="display">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>No. HP</th>
                        <th>Email</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <p id="notification-message">Transaksi berhasil disimpan!</p>
        <button onclick="closeNotification()">Tutup</button>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h3 id="modal-title">Konfirmasi</h3>
            <p id="modal-message">Apakah Anda yakin?</p>
            <button class="confirm-btn" id="modal-confirm">Ya</button>
            <button class="cancel-btn" onclick="closeModal()">Batal</button>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script>
        // Data Simulasi
        let transactions = [];
        let users = [
            { username: 'super', password: 'super', phone: '08123456789', email: 'super@example.com', role: 'superadmin' }
        ];
        let activities = [];

        let totalSaldo = 0;

        // Inisialisasi DataTables
        let transactionTable = $('#transaction-table').DataTable({
            paging: true,
            searching: true,
            ordering: true,
            language: {
                search: "Cari:",
                lengthMenu: "Tampilkan _MENU_ entri",
                info: "Menampilkan _START_ sampai _END_ dari _TOTAL_ entri",
                paginate: {
                    first: "Pertama",
                    last: "Terakhir",
                    next: "Berikutnya",
                    previous: "Sebelumnya"
                }
            }
        });

        let monthlyTable = $('#monthly-table').DataTable({
            paging: true,
            searching: true,
            ordering: true,
            language: {
                search: "Cari:",
                lengthMenu: "Tampilkan _MENU_ entri",
                info: "Menampilkan _START_ sampai _END_ dari _TOTAL_ entri",
                paginate: {
                    first: "Pertama",
                    last: "Terakhir",
                    next: "Berikutnya",
                    previous: "Sebelumnya"
                }
            }
        });

        let userTable = $('#user-table').DataTable({
            paging: true,
            searching: true,
            ordering: true,
            language: {
                search: "Cari:",
                lengthMenu: "Tampilkan _MENU_ entri",
                info: "Menampilkan _START_ sampai _END_ dari _TOTAL_ entri",
                paginate: {
                    first: "Pertama",
                    last: "Terakhir",
                    next: "Berikutnya",
                    previous: "Sebelumnya"
                }
            }
        });

        let activityTable = $('#activity-table').DataTable({
            paging: true,
            searching: true,
            ordering: true,
            language: {
                search: "Cari:",
                lengthMenu: "Tampilkan _MENU_ entri",
                info: "Menampilkan _START_ sampai _END_ dari _TOTAL_ entri",
                paginate: {
                    first: "Pertama",
                    last: "Terakhir",
                    next: "Berikutnya",
                    previous: "Sebelumnya"
                }
            }
        });

        // Fungsi Format Rupiah
        function formatRupiah(angka) {
            return 'Rp ' + parseFloat(angka || 0).toLocaleString('id-ID');
        }

        // Fungsi Terbilang
        function terbilang(angka) {
            const huruf = ["", "Satu", "Dua", "Tiga", "Empat", "Lima", "Enam", "Tujuh", "Delapan", "Sembilan", "Sepuluh", "Sebelas"];
            let temp = "";
            if (angka < 12) temp = huruf[angka];
            else if (angka < 20) temp = terbilang(angka - 10) + " Belas";
            else if (angka < 100) temp = terbilang(Math.floor(angka / 10)) + " Puluh " + terbilang(angka % 10);
            else if (angka < 200) temp = "Seratus " + terbilang(angka - 100);
            else if (angka < 1000) temp = terbilang(Math.floor(angka / 100)) + " Ratus " + terbilang(angka % 100);
            else if (angka < 2000) temp = "Seribu " + terbilang(angka - 1000);
            else if (angka < 1000000) temp = terbilang(Math.floor(angka / 1000)) + " Ribu " + terbilang(angka % 1000);
            else if (angka < 1000000000) temp = terbilang(Math.floor(angka / 1000000)) + " Juta " + terbilang(angka % 1000000);
            return temp.trim() + " Rupiah";
        }

        // Fungsi Navigasi
        function showSection(sectionId) {
            $('.page').removeClass('active');
            setTimeout(() => {
                $('.page').hide();
                $('#' + sectionId).show().addClass('active');
            }, 300);
            updateNavbar();
        }

        // Update Navbar
        function updateNavbar() {
            const user = JSON.parse(localStorage.getItem('user'));
            const navbarLinks = $('#navbar-links');
            if (user) {
                let links = `
                    <a href="#" onclick="showSection('dashboard')">Dashboard</a>
                    <a href="#" onclick="showSection('transaksi-masuk')">Transaksi Masuk</a>
                    <a href="#" onclick="showSection('transaksi-keluar')">Transaksi Keluar</a>
                    <a href="#" onclick="showSection('laporan-bulanan')">Laporan Bulanan</a>
                    <a href="#" onclick="showSection('riwayat-aktivitas')">Riwayat Aktivitas</a>
                `;
                if (user.role === 'superadmin') {
                    links += `<a href="#" onclick="showSection('pengaturan')">Pengaturan</a>`;
                }
                links += `<a href="#" onclick="showModal('logout')">Logout</a>`;
                navbarLinks.html(links);
            } else {
                navbarLinks.html(`<a href="#" onclick="showSection('login')">Login</a>`);
            }
        }

        // Form Login/Register/Forgot
        function showLoginForm() {
            $('#login-form, #register-form, #forgot-form').hide();
            $('#login-form').show();
        }

        function showRegisterForm() {
            $('#login-form, #register-form, #forgot-form').hide();
            $('#register-form').show();
        }

        function showForgotForm() {
            $('#login-form, #register-form, #forgot-form').hide();
            $('#forgot-form').show();
        }

        // Handle Login
        function handleLogin(event) {
            event.preventDefault();
            const username = $('#username').val();
            const password = $('#password').val();
            const usernameError = $('#username-error');
            const passwordError = $('#password-error');
            const loginBtn = $('.login-btn');

            usernameError.text('');
            passwordError.text('');
            loginBtn.addClass('loading').text('Memproses...');

            setTimeout(() => {
                const user = users.find(u => u.username === username && u.password === password);
                if (!user) {
                    usernameError.text('Username atau password salah!');
                    loginBtn.removeClass('loading').text('Login');
                    showNotification('Login gagal!', true);
                    return;
                }

                localStorage.setItem('user', JSON.stringify(user));
                logActivity(user.username, 'Login');
                showNotification('Login berhasil!');
                loginBtn.removeClass('loading').text('Login');
                showSection('dashboard');
            }, 1000);
        }

        // Handle Register
        function handleRegister(event) {
            event.preventDefault();
            const username = $('#reg-username').val();
            const password = $('#reg-password').val();
            const phone = $('#reg-phone').val();
            const email = $('#reg-email').val();
            const usernameError = $('#reg-username-error');
            const passwordError = $('#reg-password-error');
            const phoneError = $('#reg-phone-error');
            const emailError = $('#reg-email-error');
            const registerBtn = $('.register-btn');

            usernameError.text('');
            passwordError.text('');
            phoneError.text('');
            emailError.text('');
            registerBtn.addClass('loading').text('Memproses...');

            setTimeout(() => {
                if (users.find(u => u.username === username)) {
                    usernameError.text('Username sudah digunakan!');
                    registerBtn.removeClass('loading').text('Daftar');
                    showNotification('Pendaftaran gagal!', true);
                    return;
                }
                if (password.length < 6) {
                    passwordError.text('Password minimal 6 karakter!');
                    registerBtn.removeClass('loading').text('Daftar');
                    showNotification('Pendaftaran gagal!', true);
                    return;
                }
                if (!/^\d{10,13}$/.test(phone)) {
                    phoneError.text('Nomor HP tidak valid!');
                    registerBtn.removeClass('loading').text('Daftar');
                    showNotification('Pendaftaran gagal!', true);
                    return;
                }
                if (!email.includes('@')) {
                    emailError.text('Email tidak valid!');
                    registerBtn.removeClass('loading').text('Daftar');
                    showNotification('Pendaftaran gagal!', true);
                    return;
                }

                users.push({ username, password, phone, email, role: 'user' });
                localStorage.setItem('users', JSON.stringify(users));
                logActivity(username, 'Pendaftaran');
                showNotification('Pendaftaran berhasil! Silakan login.');
                registerBtn.removeClass('loading').text('Daftar');
                showLoginForm();
            }, 1000);
        }

        // Handle Forgot Password
        function handleForgot(event) {
            event.preventDefault();
            const email = $('#forgot-email').val();
            const emailError = $('#forgot-email-error');
            const forgotBtn = $('.forgot-btn');

            emailError.text('');
            forgotBtn.addClass('loading').text('Memproses...');

            setTimeout(() => {
                const user = users.find(u => u.email === email);
                if (!user) {
                    emailError.text('Email tidak ditemukan!');
                    forgotBtn.removeClass('loading').text('Kirim Link Pemulihan');
                    showNotification('Email tidak ditemukan!', true);
                    return;
                }

                showNotification(`Link pemulihan telah dikirim ke ${email} (simulasi).`);
                forgotBtn.removeClass('loading').text('Kirim Link Pemulihan');
                showLoginForm();
            }, 1000);
        }

        // Handle Change Password
        function handleChangePassword(event) {
            event.preventDefault();
            const currentPassword = $('#current-password').val();
            const newPassword = $('#new-password').val();
            const currentPasswordError = $('#current-password-error');
            const newPasswordError = $('#new-password-error');
            const updateBtn = $('.update-btn', '#change-password-form');

            currentPasswordError.text('');
            newPasswordError.text('');
            updateBtn.addClass('loading').text('Memproses...');

            setTimeout(() => {
                const user = JSON.parse(localStorage.getItem('user'));
                const userIndex = users.findIndex(u => u.username === user.username);
                if (users[userIndex].password !== currentPassword) {
                    currentPasswordError.text('Kata sandi saat ini salah!');
                    updateBtn.removeClass('loading').text('Ubah Kata Sandi');
                    showNotification('Gagal mengubah kata sandi!', true);
                    return;
                }
                if (newPassword.length < 6) {
                    newPasswordError.text('Kata sandi baru minimal 6 karakter!');
                    updateBtn.removeClass('loading').text('Ubah Kata Sandi');
                    showNotification('Gagal mengubah kata sandi!', true);
                    return;
                }

                users[userIndex].password = newPassword;
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('user', JSON.stringify(users[userIndex]));
                logActivity(user.username, 'Ubah Kata Sandi');
                showNotification('Kata sandi berhasil diubah!');
                updateBtn.removeClass('loading').text('Ubah Kata Sandi');
                $('#change-password-form')[0].reset();
            }, 1000);
        }

        // Format Input Rupiah dan Terbilang
        $('#saldo-masuk, #saldo-keluar').on('input', function() {
            let value = $(this).val().replace(/[^0-9]/g, '');
            $(this).val(formatRupiah(value));
            const terbilangId = $(this).attr('id') === 'saldo-masuk' ? '#terbilang-masuk' : '#terbilang-keluar';
            $(terbilangId).text(value ? terbilang(parseInt(value)) : '');
        });

        // Handle Transaksi Masuk
        $('#saldo-masuk').on('input', function() {
            const saldoMasuk = parseFloat($(this).val().replace(/[^0-9]/g, '') || 0);
            const newTotalSaldo = totalSaldo + saldoMasuk;
            $('#total-saldo-masuk').val(formatRupiah(newTotalSaldo));
        });

        function handleTransaksiMasukSubmit(event) {
            event.preventDefault();
            const saldoMasuk = $('#saldo-masuk').val().replace(/[^0-9]/g, '');
            const saldoMasukError = $('#saldo-masuk-error');

            saldoMasukError.text('');

            if (!saldoMasuk) {
                saldoMasukError.text('Saldo masuk harus diisi!');
                showNotification('Harap isi saldo masuk!', true);
                return;
            }

            showModal('save-transaksi-masuk');
        }

        function saveTransaksiMasuk(isEdit = false) {
            const id = $('#id-transaksi-masuk').val();
            const tanggal = $('#tanggal-masuk').val();
            const saldoMasuk = parseFloat($('#saldo-masuk').val().replace(/[^0-9]/g, '') || 0);
            const keteranganMasuk = $('#keterangan-masuk').val();
            const user = JSON.parse(localStorage.getItem('user'));
            const pengimput = user.username;
            totalSaldo += saldoMasuk;

            const transaction = {
                id,
                tanggal,
                saldo_masuk: saldoMasuk,
                keterangan_masuk: keteranganMasuk,
                saldo_keluar: 0,
                keterangan_keluar: '',
                pengimput
            };

            if (isEdit) {
                const index = transactions.findIndex(t => t.id === id);
                totalSaldo -= transactions[index].saldo_masuk;
                totalSaldo += saldoMasuk;
                transactions[index] = transaction;
            } else {
                transactions.push(transaction);
            }

            updateTransactionData(transaction, isEdit);
            logActivity(pengimput, isEdit ? 'Edit Transaksi Masuk' : 'Tambah Transaksi Masuk');
            showNotification(`Transaksi masuk ${isEdit ? 'diperbarui' : 'disimpan'} berhasil!`);
            requestPushNotification(`Transaksi masuk baru oleh ${pengimput}`);
            clearMasukForm();
            showSection('dashboard');
        }

        function clearMasukForm() {
            $('#transaksi-masuk-form')[0].reset();
            $('#form-masuk-title').text('Tambah Transaksi Masuk');
            $('#id-transaksi-masuk').val('TRX-' + String(transactions.length + 1).padStart(6, '0'));
            $('#tanggal-masuk').val('2025-05-09');
            $('#total-saldo-masuk').val('');
            $('#saldo-masuk-error, #terbilang-masuk').text('');
        }

        // Handle Transaksi Keluar
        $('#saldo-keluar').on('input', function() {
            const saldoKeluar = parseFloat($(this).val().replace(/[^0-9]/g, '') || 0);
            const newTotalSaldo = totalSaldo - saldoKeluar;
            $('#total-saldo-keluar').val(formatRupiah(newTotalSaldo));
        });

        function handleTransaksiKeluarSubmit(event) {
            event.preventDefault();
            const saldoKeluar = $('#saldo-keluar').val().replace(/[^0-9]/g, '');
            const saldoKeluarError = $('#saldo-keluar-error');

            saldoKeluarError.text('');

            if (!saldoKeluar) {
                saldoKeluarError.text('Saldo keluar harus diisi!');
                showNotification('Harap isi saldo keluar!', true);
                return;
            }

            showModal('save-transaksi-keluar');
        }

        function saveTransaksiKeluar(isEdit = false) {
            const id = $('#id-transaksi-keluar').val();
            const tanggal = $('#tanggal-keluar').val();
            const saldoKeluar = parseFloat($('#saldo-keluar').val().replace(/[^0-9]/g, '') || 0);
            const keteranganKeluar = $('#keterangan-keluar').val();
            const user = JSON.parse(localStorage.getItem('user'));
            const pengimput = user.username;
            totalSaldo -= saldoKeluar;

            const transaction = {
                id,
                tanggal,
                saldo_masuk: 0,
                keterangan_masuk: '',
                saldo_keluar: saldoKeluar,
                keterangan_keluar: keteranganKeluar,
                pengimput
            };

            if (isEdit) {
                const index = transactions.findIndex(t => t.id === id);
                totalSaldo += transactions[index].saldo_keluar;
                totalSaldo -= saldoKeluar;
                transactions[index] = transaction;
            } else {
                transactions.push(transaction);
            }

            updateTransactionData(transaction, isEdit);
            logActivity(pengimput, isEdit ? 'Edit Transaksi Keluar' : 'Tambah Transaksi Keluar');
            showNotification(`Transaksi keluar ${isEdit ? 'diperbarui' : 'disimpan'} berhasil!`);
            requestPushNotification(`Transaksi keluar baru oleh ${pengimput}`);
            clearKeluarForm();
            showSection('dashboard');
        }

        function clearKeluarForm() {
            $('#transaksi-keluar-form')[0].reset();
            $('#form-keluar-title').text('Tambah Transaksi Keluar');
            $('#id-transaksi-keluar').val('TRX-' + String(transactions.length + 1).padStart(6, '0'));
            $('#tanggal-keluar').val('2025-05-09');
            $('#total-saldo-keluar').val('');
            $('#saldo-keluar-error, #terbilang-keluar').text('');
        }

        // Update Transaction Data
        function updateTransactionData(transaction, isEdit) {
            $('#total-saldo').text(formatRupiah(totalSaldo));
            $('#saldo-masuk-total').text(formatRupiah(transactions.reduce((sum, t) => sum + t.saldo_masuk, 0)));
            $('#saldo-keluar-total').text(formatRupiah(transactions.reduce((sum, t) => sum + t.saldo_keluar, 0)));

            transactionTable.clear();
            transactionTable.rows.add(transactions.map(t => [
                t.id,
                t.tanggal,
                t.saldo_masuk ? formatRupiah(t.saldo_masuk) : '-',
                t.keterangan_masuk || '-',
                t.saldo_keluar ? formatRupiah(t.saldo_keluar) : '-',
                t.keterangan_keluar || '-',
                t.pengimput,
                `<button class="action-btn edit-btn" onclick="editTransaction(this)">Edit</button>
                 <button class="action-btn delete-btn" onclick="deleteTransaction(this)">Hapus</button>`
            ]));
            transactionTable.draw();

            updateMonthlyReport();
            updateDateFilter();
        }

        // Edit Transaction
        function editTransaction(button) {
            const user = JSON.parse(localStorage.getItem('user'));
            if (user.role !== 'superadmin') {
                showNotification('Hanya Super Admin yang dapat mengedit transaksi!', true);
                return;
            }

            const row = $(button).closest('tr');
            const id = row.find('td').eq(0).text();
            const transaction = transactions.find(t => t.id === id);

            if (transaction.saldo_masuk > 0) {
                $('#form-masuk-title').text('Edit Transaksi Masuk');
                $('#id-transaksi-masuk').val(transaction.id);
                $('#tanggal-masuk').val(transaction.tanggal);
                $('#saldo-masuk').val(formatRupiah(transaction.saldo_masuk));
                $('#keterangan-masuk').val(transaction.keterangan_masuk);
                $('#total-saldo-masuk').val(formatRupiah(totalSaldo));
                $('#terbilang-masuk').text(terbilang(transaction.saldo_masuk));
                showSection('transaksi-masuk');
            } else {
                $('#form-keluar-title').text('Edit Transaksi Keluar');
                $('#id-transaksi-keluar').val(transaction.id);
                $('#tanggal-keluar').val(transaction.tanggal);
                $('#saldo-keluar').val(formatRupiah(transaction.saldo_keluar));
                $('#keterangan-keluar').val(transaction.keterangan_keluar);
                $('#total-saldo-keluar').val(formatRupiah(totalSaldo));
                $('#terbilang-keluar').text(terbilang(transaction.saldo_keluar));
                showSection('transaksi-keluar');
            }
        }

        // Delete Transaction
        function deleteTransaction(button) {
            const user = JSON.parse(localStorage.getItem('user'));
            if (user.role !== 'superadmin') {
                showNotification('Hanya Super Admin yang dapat menghapus transaksi!', true);
                return;
            }

            const row = $(button).closest('tr');
            const id = row.find('td').eq(0).text();
            const transaction = transactions.find(t => t.id === id);

            showModal('delete-transaction', () => {
                transactions = transactions.filter(t => t.id !== id);
                totalSaldo -= transaction.saldo_masuk;
                totalSaldo += transaction.saldo_keluar;
                updateTransactionData({ saldo_masuk: 0, saldo_keluar: 0 }, false);
                logActivity(user.username, 'Hapus Transaksi');
                showNotification('Transaksi dihapus!');
            });
        }

        // Update Monthly Report
        function updateMonthlyReport() {
            const monthlyData = {};
            transactions.forEach(t => {
                const month = t.tanggal.slice(0, 7);
                if (!monthlyData[month]) {
                    monthlyData[month] = { masuk: 0, keluar: 0 };
                }
                monthlyData[month].masuk += t.saldo_masuk;
                monthlyData[month].keluar += t.saldo_keluar;
            });

            monthlyTable.clear();
            monthlyTable.rows.add(Object.keys(monthlyData).map(m => [
                m,
                formatRupiah(monthlyData[m].masuk),
                formatRupiah(monthlyData[m].keluar),
                formatRupiah(monthlyData[m].masuk - monthlyData[m].keluar)
            ]));
            monthlyTable.draw();
        }

        // Update Date Filter
        function updateDateFilter() {
            const dates = [...new Set(transactions.map(t => t.tanggal))];
            $('#date-filter').html('<option value="">Semua Tanggal</option>' + dates.map(d => `<option value="${d}">${d}</option>`).join(''));
        }

        // Handle Settings
        function handleSettingsSubmit(event) {
            event.preventDefault();
            const phone = $('#settings-phone').val();
            const email = $('#settings-email').val();
            const updateBtn = $('.update-btn', '#settings-form');

            updateBtn.addClass('loading').text('Memproses...');

            setTimeout(() => {
                const user = JSON.parse(localStorage.getItem('user'));
                const userIndex = users.findIndex(u => u.username === user.username);
                users[userIndex].phone = phone;
                users[userIndex].email = email;
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('user', JSON.stringify(users[userIndex]));
                logActivity(user.username, 'Perbarui Pengaturan');
                showNotification('Pengaturan diperbarui!');
                updateBtn.removeClass('loading').text('Perbarui');
            }, 1000);
        }

        // Handle Add User
        function handleAddUser(event) {
            event.preventDefault();
            const username = $('#add-username').val();
            const password = $('#add-password').val();
            const phone = $('#add-phone').val();
            const email = $('#add-email').val();
            const saveBtn = $('.save-btn');

            saveBtn.addClass('loading').text('Memproses...');

            setTimeout(() => {
                if (users.find(u => u.username === username)) {
                    showNotification('Username sudah digunakan!', true);
                    saveBtn.removeClass('loading').text('Tambah Pengguna');
                    return;
                }

                users.push({ username, password, phone, email, role: 'user' });
                localStorage.setItem('users', JSON.stringify(users));
                updateUserTable();
                logActivity(username, 'Tambah Pengguna');
                showNotification('Pengguna ditambahkan!');
                saveBtn.removeClass('loading').text('Tambah Pengguna');
                $('#add-user-form')[0].reset();
            }, 1000);
        }

        // Update User Table
        function updateUserTable() {
            userTable.clear();
            userTable.rows.add(users.map(u => [
                u.username,
                u.phone,
                u.email,
                `<button class="action-btn delete-btn" onclick="deleteUser('${u.username}')">Hapus</button>`
            ]));
            userTable.draw();
        }

        // Delete User
        function deleteUser(username) {
            showModal('delete-user', () => {
                users = users.filter(u => u.username !== username);
                localStorage.setItem('users', JSON.stringify(users));
                updateUserTable();
                logActivity(JSON.parse(localStorage.getItem('user')).username, 'Hapus Pengguna');
                showNotification('Pengguna dihapus!');
            });
        }

        // Log Activity
        function logActivity(username, activity) {
            const waktu = new Date().toISOString().slice(0, 19).replace('T', ' ');
            activities.push({ waktu, username, activity });
            localStorage.setItem('activities', JSON.stringify(activities));
            activityTable.clear();
            activityTable.rows.add(activities.map(a => [a.waktu, a.username, a.activity]));
            activityTable.draw();
        }

        // Cetak Tabel
        function printTable() {
            const tableHtml = document.getElementById('transaction-table').outerHTML;
            const printWin = window.open('', '_blank');
            printWin.document.write(`
                <html>
                    <head>
                        <title>Cetak Transaksi</title>
                        <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
                        <style>
                            body { font-family: Arial, sans-serif; }
                            table { width: 100%; border-collapse: collapse; }
                            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                            th { background-color: #f2f2f2; }
                        </style>
                    </head>
                    <body>${tableHtml}</body>
                </html>
            `);
            printWin.document.close();
            printWin.focus();
            printWin.print();
            printWin.close();
        }

        // Export CSV
        function exportToCSV() {
            let csv = 'ID Transaksi,Tanggal,Saldo Masuk,Keterangan Masuk,Saldo Keluar,Keterangan Keluar,ID Pengimput\n';
            transactions.forEach(t => {
                csv += `${t.id},${t.tanggal},${t.saldo_masuk || '-'},${t.keterangan_masuk || '-'},${t.saldo_keluar || '-'},${t.keterangan_keluar || '-'},${t.pengimput}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'transaksi.csv';
            link.click();
        }

        // Export PDF
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text('Laporan Transaksi', 10, 10);
            let y = 20;
            transactions.forEach(t => {
                doc.text(`ID: ${t.id}, Tanggal: ${t.tanggal}, Masuk: ${t.saldo_masuk ? formatRupiah(t.saldo_masuk) : '-'}, Keluar: ${t.saldo_keluar ? formatRupiah(t.saldo_keluar) : '-'}, Pengimput: ${t.pengimput}`, 10, y);
                y += 10;
            });
            doc.save('transaksi.pdf');
        }

        // Filter Tabel
        $('#date-filter, #type-filter').on('change', function() {
            const dateFilter = $('#date-filter').val();
            const typeFilter = $('#type-filter').val();

            transactionTable.clear();
            const filteredTransactions = transactions.filter(t => {
                const dateMatch = !dateFilter || t.tanggal === dateFilter;
                const typeMatch = !typeFilter ||
                    (typeFilter === 'masuk' && t.saldo_masuk > 0) ||
                    (typeFilter === 'keluar' && t.saldo_keluar > 0);
                return dateMatch && typeMatch;
            });

            transactionTable.rows.add(filteredTransactions.map(t => [
                t.id,
                t.tanggal,
                t.saldo_masuk ? formatRupiah(t.saldo_masuk) : '-',
                t.keterangan_masuk || '-',
                t.saldo_keluar ? formatRupiah(t.saldo_keluar) : '-',
                t.keterangan_keluar || '-',
                t.pengimput,
                `<button class="action-btn edit-btn" onclick="editTransaction(this)">Edit</button>
                 <button class="action-btn delete-btn" onclick="deleteTransaction(this)">Hapus</button>`
            ]));
            transactionTable.draw();
        });

        // Filter Tahunan
        $('#year-filter').on('change', function() {
            const yearFilter = $('#year-filter').val();
            const monthlyData = {};
            transactions.forEach(t => {
                const month = t.tanggal.slice(0, 7);
                if (!yearFilter || t.tanggal.startsWith(yearFilter)) {
                    if (!monthlyData[month]) {
                        monthlyData[month] = { masuk: 0, keluar: 0 };
                    }
                    monthlyData[month].masuk += t.saldo_masuk;
                    monthlyData[month].keluar += t.saldo_keluar;
                }
            });

            monthlyTable.clear();
            monthlyTable.rows.add(Object.keys(monthlyData).map(m => [
                m,
                formatRupiah(monthlyData[m].masuk),
                formatRupiah(monthlyData[m].keluar),
                formatRupiah(monthlyData[m].masuk - monthlyData[m].keluar)
            ]));
            monthlyTable.draw();
        });

        // Simulasi Push Notification
        function requestPushNotification(message) {
            if (Notification.permission === 'granted') {
                new Notification(message);
            } else if (Notification.permission !== 'denied') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        new Notification(message);
                    }
                });
            }
        }

        // Modal
        function showModal(action, callback) {
            $('#modal').show();
            if (action === 'logout') {
                $('#modal-title').text('Konfirmasi Logout');
                $('#modal-message').text('Apakah Anda yakin ingin logout?');
                $('#modal-confirm').off('click').on('click', () => {
                    const user = JSON.parse(localStorage.getItem('user'));
                    logActivity(user.username, 'Logout');
                    localStorage.removeItem('user');
                    showSection('login');
                    closeModal();
                    showNotification('Berhasil logout!');
                });
            } else if (action === 'save-transaksi-masuk') {
                $('#modal-title').text('Konfirmasi Transaksi');
                $('#modal-message').text('Apakah Anda yakin ingin menyimpan transaksi masuk ini?');
                $('#modal-confirm').off('click').on('click', () => {
                    saveTransaksiMasuk($('#form-masuk-title').text().includes('Edit'));
                    closeModal();
                });
            } else if (action === 'save-transaksi-keluar') {
                $('#modal-title').text('Konfirmasi Transaksi');
                $('#modal-message').text('Apakah Anda yakin ingin menyimpan transaksi keluar ini?');
                $('#modal-confirm').off('click').on('click', () => {
                    saveTransaksiKeluar($('#form-keluar-title').text().includes('Edit'));
                    closeModal();
                });
            } else if (action === 'delete-transaction') {
                $('#modal-title').text('Konfirmasi Hapus');
                $('#modal-message').text('Apakah Anda yakin ingin menghapus transaksi ini?');
                $('#modal-confirm').off('click').on('click', () => {
                    callback();
                    closeModal();
                });
            } else if (action === 'delete-user') {
                $('#modal-title').text('Konfirmasi Hapus');
                $('#modal-message').text('Apakah Anda yakin ingin menghapus pengguna ini?');
                $('#modal-confirm').off('click').on('click', () => {
                    callback();
                    closeModal();
                });
            }
        }

        function closeModal() {
            $('#modal').hide();
        }

        // Notifikasi
        function showNotification(message, isError = false) {
            const notif = $('#notification');
            $('#notification-message').text(message);
            notif.removeClass('error').addClass(isError ? 'error' : '').addClass('show');
            setTimeout(() => notif.removeClass('show'), 5000);
        }

        function closeNotification() {
            $('#notification').removeClass('show');
        }

        // Inisialisasi
        const storedUsers = localStorage.getItem('users');
        if (storedUsers) users = JSON.parse(storedUsers);
        const storedActivities = localStorage.getItem('activities');
        if (storedActivities) activities = JSON.parse(storedActivities);
        updateUserTable();
        updateMonthlyReport();
        updateDateFilter();
        activityTable.clear();
        activityTable.rows.add(activities.map(a => [a.waktu, a.username, a.activity]));
        activityTable.draw();

        const user = JSON.parse(localStorage.getItem('user'));
        showSection(user ? 'dashboard' : 'login');

        const settingsUser = JSON.parse(localStorage.getItem('user'));
        if (settingsUser) {
            $('#settings-phone').val(settingsUser.phone);
            $('#settings-email').val(settingsUser.email);
        }
    </script>
</body>
    </html>
